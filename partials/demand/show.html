<h2>{{ project.name }}</h2>
<lang-bar lang="actualLang" all-langs="langs" langs="languages" class="pull-right"></lang-bar>
<tabset>
  <tab heading="Information" ng-click="loadInformation()">
    <h3>
      <select ng-change="categoryChange()" ng-model="demand.category" ng-options="key as value for (key, value) in categories"></select>
      <span ng-show="loadCategory" us-spinner="bigSpinner"></span>
      <i ng-show="loadCategoryFinish" class="glyphicon glyphicon-ok" style="color:green;"></i>
      {{ demand.id }}:
      <input ng-keyup="titleChange()" ng-model="demand.title">
      <span ng-show="titleHasChange">
        <button ng-click="titleSave()"   class="btn btn-default glyphicon glyphicon-ok"     style="color:green;"></button>
        <button ng-click="titleCancel()" class="btn btn-default glyphicon glyphicon-remove" style="color:red;"  ></button>
      </span>
    </h3>
    <hr>
    <div class="row">
      <div class="col-xs-9">
        <div class="row">
          <h3>Details</h3>
          <div class="col-xs-6">
            <strong>Status: </strong>
            <select ng-change="statusChange()" ng-model="demand.status" ng-options="key as value for (key, value) in statuses"></select>
            <span ng-show="loadStatus" us-spinner="littleSpinner"></span>
            <i ng-show="loadStatusFinish" class="glyphicon glyphicon-ok" style="color:green;"></i>
          </div>
          <div class="col-xs-6">
            <strong>Created at: </strong>
            <span>{{demand.created_at |date}}</span>
          </div>
          <div class="col-xs-6">
            <strong>Last Update: </strong>
            <span>{{demand.last_edit |date |default:'Never updated'}}</span>
          </div>
        </div>
        <hr>
        <textarea ng-keyup="descriptionChange()" class="input-block-level" ng-model="demand.description"></textarea>
        <span ng-show="descriptionHasChange">
          <button ng-click="descriptionSave()"   class="btn btn-default glyphicon glyphicon-ok"     style="color:green;"></button>
          <button ng-click="descriptionCancel()" class="btn btn-default glyphicon glyphicon-remove" style="color:red;"  ></button>
        </span>
        <hr>
      </div>
    </div>
  </tab>
  <tab heading="History" ng-click="loadHistory()" active="historyTab">
    <div ng-controller="HistoryCtrl">
      <accordion close-others="oneAtATime" close-others="true">
        <accordion-group ng-repeat="history in histories">
          <accordion-heading>
            <h5>Change on {{ history.0 }}</h5>
            <p>by {{ history.1 }} the {{ history.2 |date }}</p>
          </accordion-heading>
          {{ history.3 }}
        </accordion-group>
      </accordion>
      <p ng-if="histories.length == 0">No history for the moment</p>
    </div>
  </tab>
</tabset>
<div class="row">
  <div class="col-xs-9">
    <tabset>
      <tab heading="Comments" ng-controller="CommentCtrl">
        <div class="row" ng-repeat="comment in comments">
          <div class="col-xs-2">
            <p>{{ comment.created_at | date }}</p>
            <p>{{ comment.author }}</p>
          </div>
          <div class="col-xs-10">{{ comment.message }}</div>

          <div class="col-xs-10">
            <button ng-click="votedown($index)" class="btn btn-link" style="color:red;">{{ comment.votedown }}<i class="glyphicon glyphicon-chevron-down"></i></button>
            <button ng-click="voteup($index)" class="btn btn-link" style="color:green;"><i class="glyphicon glyphicon-chevron-up"></i>{{ comment.voteup }}</button>
          </div>
        </div>
        <div class="row">
          <form ng-submit="addComment()">
            <textarea ng-model="newComment.message"></textarea><br/>
            <button type="submit">Submit</button>
          </form>
        </div>
      </tab>
    </tabset>
  </div>
</div>

